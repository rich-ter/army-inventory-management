{% extends 'base.html' %}

{% load static %}

{% block title %}Product Details{% endblock %}

{% block css %}
<link href="{% static 'plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css' %}" rel="stylesheet">
{% endblock %}

{% block js %}
<script src="{% static 'plugins/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' %}"></script>
<script>
$(document).ready(function() {
    $('#add-more-items').click(function() {
        var totalForms = $('#id_' + '{{ formset.prefix }}-TOTAL_FORMS');
        var currentFormCount = parseInt(totalForms.val());
        var formsetContainer = $("#shipment-items-container");
        
        // Clone the last form in the formset
        var lastForm = $(".shipment-item-form:last").clone(true);

        // Update the form number in the form's input names and IDs
        lastForm.find(':input').each(function() {
            var name = $(this).attr('name');
            var id = $(this).attr('id');

            // Increment form index in the name and id for the cloned form inputs and labels
            name = name.replace(/-\d+-/, '-' + currentFormCount + '-');
            id = id.replace(/-\d+-/, '-' + currentFormCount + '-');

            $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
        });

        // Update labels for new inputs
        lastForm.find('label').each(function() {
            var newFor = $(this).attr('for').replace(/-\d+-/, '-' + currentFormCount + '-');
            $(this).attr('for', newFor);
        });

        // Increment the TOTAL_FORMS count
        totalForms.val(currentFormCount + 1);

        // Append the cloned form to the container
        lastForm.appendTo(formsetContainer);
    });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var shipmentTypeSelect = document.getElementById('shipment_type_id');
    var recipientSelect = document.getElementById('recipient_id');

    function toggleRecipientField() {
        if (shipmentTypeSelect.value === 'OUT') {
            recipientSelect.style.display = 'block';
        } else {
            recipientSelect.style.display = 'none';
        }
    }

    // Event listener for changes to the shipment type field
    shipmentTypeSelect.addEventListener('change', toggleRecipientField);

    // Call the function to set the initial state
    toggleRecipientField();
});
</script>
{% endblock %} 

{% block content %}
	<div class="d-flex align-items-center mb-3">
		<div>
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="javascript:;">PAGES</a></li>
				<li class="breadcrumb-item active">PRODUCT DETAILS</li>
			</ol>
			<h1 class="page-header mb-0">Καταχώρηση Διακίνισης</h1>
		</div>
	</div>
	<div class="row gx-4">
		<div class="col-lg-8">
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Πληροφορίες Διακίνισης
				</div>
				<form method="post" enctype="multipart/form-data">
					{% csrf_token %}
					{{ form.non_field_errors }}
					<div class="card-body">
						{{ form.as_p }}
					<!-- Shipment Item Section -->
					<div class="card mb-4">
						<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
							Shipment Items
						</div>
						<div class="card-body" id="shipment-items-container">
							{{ formset.management_form }}
							{% for form in formset %}
							    <div class="shipment-item-form">
									<div class="row">
										<!-- Product Field -->
										<div class="col-md-4">
											<div class="mb-3">
												{{ form.product.label_tag }}
												{{ form.product }}
												{{ form.product.errors }}
											</div>
										</div>
										<!-- Warehouse Field -->
										<div class="col-md-4">
											<div class="mb-3">
												{{ form.warehouse.label_tag }}
												{{ form.warehouse }}
												{{ form.warehouse.errors }}
											</div>
										</div>
										<!-- Quantity Field -->
										<div class="col-md-4">
											<div class="mb-3">
												{{ form.quantity.label_tag }}
												{{ form.quantity }}
												{{ form.quantity.errors }}
											</div>
										</div>
									</div>
							</div>
							{% endfor %}
						</div>
							<button type="button" id="add-more-items" class="btn btn-info">Add More Items</button>

					</div>
				</div>
				{% comment %} <div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div> {% endcomment %}
			</div>
		</div>
	</div>
	<button type="submit" class="btn btn-outline-theme btn-lg">Καταχώρηση Διακίνησης</button>
</form>

{% endblock %}

{% block outter_content %}



	{% verbatim %}




<!-- script -->
<script>
  $('#datepicker').datepicker({
    autoclose: true
  });
</script>

		<!-- BEGIN template-download -->
		<script id="template-download" type="text/x-tmpl">
		{% for (var i=0, file; file=o.files[i]; i++) { %}
			<tr class="template-download">
				<td>
					<span class="preview d-flex justify-content-center flex-align-center" style="height: 80px">
						{% if (file.thumbnailUrl) { %}
							<a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
						{% } %}
					</span>
				</td>
				<td>
					<p class="name">
						{% if (file.url) { %}
							<a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
						{% } else { %}
							<span>{%=file.name%}</span>
						{% } %}
					</p>
					{% if (file.error) { %}
						<div><span class="label label-danger">Error</span> {%=file.error%}</div>
					{% } %}
				</td>
				<td>
					<span class="size">{%=o.formatFileSize(file.size)%}</span>
				</td>
				<td nowrap>
					{% if (file.deleteUrl) { %}
						<button class="btn btn-outline-danger btn-sm btn-block delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
							<span>Delete</span>
						</button>
						<div class="form-check mt-2">
							<input type="checkbox" id="{%=file.deleteUrl%}" name="delete" value="1" class="form-check-input toggle">
							<label for="{%=file.deleteUrl%}" class="form-check-label"></label>
						</div>
					{% } else { %}
						<button class="btn btn-outline-default btn-sm d-block w-100 cancel">
							<span>Cancel</span>
						</button>
					{% } %}
				</td>
			</tr>
		{% } %}
		</script>
		<!-- END template-download -->
	{% endverbatim %}
{% endblock %} 