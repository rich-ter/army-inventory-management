{% extends 'base.html' %}


{% load static %}

{% block title %}Order Details{% endblock %}

{% block css %}
	<link href="{% static 'plugins/jquery-typeahead/dist/jquery.typeahead.min.css' %}" rel="stylesheet" />
{% endblock %}


{% block js %}
<script src="{% static 'plugins/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'plugins/jquery-typeahead/dist/jquery.typeahead.min.js' %}"></script>
<script>
$(document).ready(function() {
    let productsMap = {}; // Object to hold product name as key and product object as value for quick access

    fetch('/api/products/')
    .then(response => response.json())
    .then(data => {
        // Populate the productsMap with product names as keys
        data.forEach(product => {
            productsMap[product.name] = product;
        });

        // Initialize typeahead with product names
        $('#typeahead').typeahead({
            source: Object.keys(productsMap),
            afterSelect: function(selectedName) {
                // Access the selected product's details from productsMap using the selected name
                let selectedProduct = productsMap[selectedName];
                if (selectedProduct) {
                    console.log("Selected Product:", selectedProduct);
                    $('#typeahead').val(selectedName); // Update the input field with the selected product name
                    
                    // Update product details in the HTML
                    $('#selected-product-name').text(selectedProduct.name);
                    $('#selected-product-serial').text('SKU: ' + selectedProduct.serial_number);
                }
            }
        });
    });

    $('#add-product-btn').click(function(e) {
        e.preventDefault();
        let selectedName = $('#typeahead').val();
        if (selectedName) {
            let selectedProduct = productsMap[selectedName];
            if (selectedProduct) {
                console.log("Product to add:", selectedProduct);
                appendProductNameToList(selectedProduct);
            } else {
                console.log("No product found for:", selectedName);
            }
        } else {
            console.log("No product selected");
        }
    });

function appendProductNameToList(product) {
    const productList = $('#product-list');
    const imageUrl = product.image ? product.image : '{% static "img/placeholder.jpg" %}'; // Use placeholder image if product image is not available
    const productEntryHtml = `
        <div class="row align-items-center my-2">
            <div class="col-lg-8 d-flex align-items-center">
                <div class="h-65px w-65px d-flex align-items-center justify-content-center position-relative bg-white p-1">
                    <img src="${imageUrl}" alt="${product.name}" class="mw-100 mh-100"> <!-- Use product image URL -->
                    <span class="w-20px h-20px p-0 d-flex align-items-center justify-content-center badge bg-theme text-theme-color position-absolute end-0 top-0 fw-bold fs-12px rounded-pill mt-n2 me-n2">1</span>
                </div>
                <div class="ps-3 flex-1">
                    <div>${product.name}</div>
                    <div class="text-muted">Serial Number: ${product.serial_number || 'N/A'}</div>
                    <!-- Add more product details here if needed -->
                </div>
            </div>
            <div class="col-lg-2 m-0 ps-lg-3">
                <!-- Prices -->
			<div class="col-lg-2 m-0 ps-lg-3">
        	<select class="form-select" name="warehouse_id">
				<option value="">-- Select Warehouse --</option>
				{% for warehouse in warehouses %}
					<option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
				{% endfor %}
        	</select>
			</div>
            </div>
            <div class="col-lg-2 m-0 text-end">
                <!-- Prices -->
            </div>
        </div>`;
    productList.append(productEntryHtml);
}


});

</script>


{% endblock %}



<!-- Other scripts -->

{% block content %}
	<div class="d-flex align-items-center mb-3">
		<div>
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="javascript:;">PAGES</a></li>
				<li class="breadcrumb-item active">ORDER DETAILS</li>
			</ol>
			<h1 class="page-header mb-0">Προσθήκη Διακίνισης</h1>
		</div>
	</div>
	
	<div class="mb-3 d-md-flex fw-bold">
		<div class="mt-md-0 mt-2"><a href="#" class="text-decoration-none text-inverse"><i class="bi bi-printer fa-fw me-1 text-inverse text-opacity-50"></i> Print</a></div>
		<div class="ms-md-4 mt-md-0 mt-2"><a href="#" class="text-decoration-none text-inverse"><i class="bi bi-boxes fa-fw me-1 text-inverse text-opacity-50"></i> Restock items</a></div>
		<div class="ms-md-4 mt-md-0 mt-2"><a href="#" class="text-decoration-none text-inverse"><i class="bi bi-pen fa-fw me-1 text-inverse text-opacity-50"></i> Edit</a></div>
		<div class="ms-md-4 mt-md-0 mt-2 dropdown-toggle">
			<a href="#" data-bs-toggle="dropdown" class="text-decoration-none text-inverse"><i class="bi bi-gear fa-fw me-1 text-inverse text-opacity-50"></i> More Actions</a>
			<div class="dropdown-menu">
				<a class="dropdown-item" href="#">Action</a>
				<a class="dropdown-item" href="#">Another action</a>
				<a class="dropdown-item" href="#">Something else here</a>
				<div role="separator" class="dropdown-divider"></div>
				<a class="dropdown-item" href="#">Separated link</a>
			</div>
		</div>
	</div>
	<div class="row gx-4">
		<div class="col-lg-8">
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Products (3)
					<a href="#" class="ms-auto text-decoration-none text-inverse text-opacity-50"><i class="bi bi-truck fa-lg me-1"></i> Add Tracking Link</a>
				</div>
				<div id="product-list" class="card-body text-inverse">
					<!-- NEW CODE FOR POPULATING RESULTS IN THE FRONT END-->
				<div class="row align-items-center" id="product-details">
					<div class="col-lg-8 d-flex align-items-center">
						<div class="h-65px w-65px d-flex align-items-center justify-content-center position-relative bg-white p-1">
							<img id="product-image" src="" alt="" class="mw-100 mh-100">
							<span class="w-20px h-20px p-0 d-flex align-items-center justify-content-center badge bg-theme text-theme-color position-absolute end-0 top-0 fw-bold fs-12px rounded-pill mt-n2 me-n2">1</span>
						</div>
						<div class="ps-3 flex-1">
							<div id="product-name"><a href="#" class="text-decoration-none text-inverse"></a></div>
							<div id="product-serial" class="text-inverse text-opacity-50 small">
								SKU: 
							</div>
							<div id="product-usage" class="text-inverse text-opacity-50 small">
								Usage: 
							</div>
						</div>
					</div>
					<div class="col-lg-2 m-0 ps-lg-3">
						<!-- Prices -->
					</div>
					<div class="col-lg-2 m-0 text-end">
						<!-- Prices -->
					</div>
				</div>
									<hr class="my-4">
			<!-- IT ENDS HERE-->

		<!-- Modify the product entry HTML to include a dropdown menu for selecting the warehouse -->
		<div class="row align-items-center my-2 product-entry">
			<div class="col-lg-8 d-flex align-items-center">
				<div class="h-65px w-65px d-flex align-items-center justify-content-center position-relative bg-white p-1">
					<img src="{% static 'img/product/product-1.jpg' %}" alt="" class="mw-100 mh-100">
					<span class="w-20px h-20px p-0 d-flex align-items-center justify-content-center badge bg-theme text-theme-color position-absolute end-0 top-0 fw-bold fs-12px rounded-pill mt-n2 me-n2">1</span>
				</div>
				<div class="ps-3 flex-1">
					<div>{{ product.name }}</div>
					<div class="text-muted">Serial Number: {{ product.serial_number }}</div>
				</div>
			</div>
			<div class="col-lg-2 m-0 ps-lg-3">
				<select class="form-select" name="warehouse_id">
					<option value="">-- Select Warehouse --</option>
					{% for warehouse in warehouses %}
						<option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
					{% endfor %}
				</select>
			</div>
			<div class="col-lg-2 m-0 text-end">
				<!-- Prices -->
			</div>
			<div class="col-lg-2 m-0 text-end">
				<!-- Dropdown menu for selecting warehouse -->

			</div>
		</div>


					<hr class="my-4">
					<div class="row">
						<div class="col-lg-8 d-flex align-items-center">
							<div class="h-65px w-65px d-flex align-items-center justify-content-center position-relative bg-white p-1">
								<img src="{% static 'img/product/product-3.jpg' %}" alt="" class="mw-100 mh-100">
								<span class="w-20px h-20px p-0 d-flex align-items-center justify-content-center badge bg-theme text-theme-color position-absolute end-0 top-0 fw-bold fs-12px rounded-pill mt-n2 me-n2">1</span>
							</div>
							<div class="ps-3 flex-1">
								<div class=""><a href="#" class="text-decoration-none text-inverse">Apple Watch 5</a></div>
								<div class="text-inverse text-opacity-50 small">
									SKU: APPLEWATCHBLACK
								</div>
							</div>
						</div>
						<div class="col-lg-2 m-0 ps-lg-3">
							$599 x 1
						</div>
						<div class="col-lg-2 text-inverse m-0 text-end">
							$599
						</div>
					</div>
				</div>
				<div class="card-footer bg-none">
					<div class="row justify-content-center"> <!-- Center the content horizontally -->
						<div class="col-auto"> <!-- Use 'col-auto' for the search field to take necessary width -->
							<div class="typeahead__container">
								<div class="typeahead__field">
									<div class="typeahead__query input-group">
										<span class="input-group-text"><i class="fa fa-search"></i></span>
										<input class="form-control" style="width: 300px;" name="country_v1[query]" id="typeahead" placeholder="Type 'af'" autocomplete="off"> <!-- Inline style for width -->
									</div>
								</div>
							</div>
						</div>
						<div class="col-auto">
							<a href="#" id="add-product-btn" class="btn btn-outline-theme ms-2">Προσθήκη Προιόντος</a>
						</div>
								<div class="col-auto">
			<a href="#" id="create-shipment-btn" class="btn btn-outline-theme ms-2">Create Shipment</a>
		</div>
					</div>
				</div>

				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Σχόλια Κίνησης
					<a href="#" class="ms-auto text-decoration-none text-inverse text-opacity-50">Edit</a>
				</div>
				<div class="card-body">
					No notes from customer
				</div>
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Παραλήπτης
					<a href="#" class="ms-auto text-decoration-none text-inverse text-opacity-50">Edit</a>
				</div>
				<div class="card-body fw-bold">
					<div class="d-flex align-items-center">
						<a href="#" class="d-block"><img src="{% static 'img/user/user-1.jpg' %}" alt="" width="45" class="rounded-pill"></a>
						<div class="flex-1 ps-3">
							<a href="#" class="d-block text-decoration-none">John Smith</a>
							johnsmith@gmail.com
						</div>
					</div>
				</div>
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Shipping Information
					<a href="#" class="ms-auto text-decoration-none text-inverse text-opacity-50">Edit</a>
				</div>
				<div class="card-body fw-bold">
					<i class="bi bi-telephone-fill fa-fw"></i> +916-663-4289<br><br>
					867 Highland View Drive<br>
					Newcastle, CA<br>
					California<br>
					95658<br>
					<br>
					<a href="#" class="text-decoration-none"><i class="bi bi-geo-alt-fill fa-fw"></i> View map</a>
				</div>
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
			<div class="card mb-4">
				<div class="card-header d-flex align-items-center bg-inverse bg-opacity-10 fw-400">
					Billing Information
					<a href="#" class="ms-auto text-decoration-none text-inverse text-opacity-50">Edit</a>
				</div>
				<div class="card-body fw-bold">
					867 Highland View Drive<br>
					Newcastle, CA<br>
					California<br>
					95658<br>
				</div>
				<div class="card-arrow">
					<div class="card-arrow-top-left"></div>
					<div class="card-arrow-top-right"></div>
					<div class="card-arrow-bottom-left"></div>
					<div class="card-arrow-bottom-right"></div>
				</div>
			</div>
		</div>
	</div>


	{% endblock %}


